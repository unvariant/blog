<style>
  .code-block {
    display: flex;
    flex-direction: row;
  }
  .code-block-lines {
    font-size: 20px;
    font-family: "JetBrains Mono";
    color: #6a737d;

    display: flex;
    flex-direction: column;

    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 and IE 11 */
    user-select: none; /* Standard syntax */
  }
  pre code.hljs {
    font-size: 20px;
    font-family: "JetBrains Mono";
  }
  pre {
    margin-top: 0;
    margin-bottom: 0;
  }

  .hljs {
    color: #24292e;
    background: #ffffff;
  }

  .hljs-doctag,
  .hljs-keyword,
  .hljs-meta .hljs-keyword,
  .hljs-template-tag,
  .hljs-template-variable,
  .hljs-type,
  .hljs-variable.language_ {
    /* prettylights-syntax-keyword */
    color: #d73a49;
  }

  .hljs-title,
  .hljs-title.class_,
  .hljs-title.class_.inherited__,
  .hljs-title.function_ {
    /* prettylights-syntax-entity */
    color: #6f42c1;
  }

  .hljs-attr,
  .hljs-attribute,
  .hljs-literal,
  .hljs-meta,
  .hljs-number,
  .hljs-operator,
  .hljs-variable,
  .hljs-selector-attr,
  .hljs-selector-class,
  .hljs-selector-id {
    /* prettylights-syntax-constant */
    color: #005cc5;
  }

  .hljs-regexp,
  .hljs-string,
  .hljs-meta .hljs-string {
    /* prettylights-syntax-string */
    color: #032f62;
  }

  .hljs-built_in,
  .hljs-symbol {
    /* prettylights-syntax-variable */
    color: #e36209;
  }

  .hljs-comment,
  .hljs-code,
  .hljs-formula {
    /* prettylights-syntax-comment */
    color: #6a737d;
  }

  .hljs-name,
  .hljs-quote,
  .hljs-selector-tag,
  .hljs-selector-pseudo {
    /* prettylights-syntax-entity-tag */
    color: #22863a;
  }

  .hljs-subst {
    /* prettylights-syntax-storage-modifier-import */
    color: #24292e;
  }

  .hljs-section {
    /* prettylights-syntax-markup-heading */
    color: #005cc5;
    font-weight: bold;
  }

  .hljs-bullet {
    /* prettylights-syntax-markup-list */
    color: #735c0f;
  }

  .hljs-emphasis {
    /* prettylights-syntax-markup-italic */
    color: #24292e;
    font-style: italic;
  }

  .hljs-strong {
    /* prettylights-syntax-markup-bold */
    color: #24292e;
    font-weight: bold;
  }

  .hljs-addition {
    /* prettylights-syntax-markup-inserted */
    color: #22863a;
    background-color: #f0fff4;
  }

  .hljs-deletion {
    /* prettylights-syntax-markup-deleted */
    color: #b31d28;
    background-color: #ffeef0;
  }

  .hljs-char.escape_,
  .hljs-link,
  .hljs-params,
  .hljs-property,
  .hljs-punctuation,
  .hljs-tag {
    /* purposely ignored */
  }
</style>
<div class="code-block"><pre class="code-block-lines"><span>   0 │ 
   1 │ 
   2 │ 
   3 │ 
   4 │ 
   5 │ 
   6 │ 
   7 │ 
   8 │ 
   9 │ 
  10 │ 
  11 │ 
  12 │ 
  13 │ 
  14 │ 
  15 │ 
  16 │ 
  17 │ 
  18 │ 
  19 │ 
  20 │ 
  21 │ 
  22 │ 
  23 │ 
  24 │ 
  25 │ 
  26 │ 
  27 │ 
  28 │ 
  29 │ 
  30 │ 
  31 │ 
  32 │ 
  33 │ 
  34 │ 
  35 │ 
  36 │ 
  37 │ 
  38 │ 
  39 │ 
  40 │ 
  41 │ 
  42 │ 
  43 │ 
  44 │ 
  45 │ 
  46 │ 
  47 │ 
  48 │ 
  49 │ 
  50 │ 
  51 │ 
  52 │ 
  53 │ 
  54 │ 
  55 │ 
  56 │ 
  57 │ 
  58 │ 
  59 │ 
  60 │ 
  61 │ 
  62 │ 
  63 │ 
  64 │ 
  65 │ 
  66 │ 
  67 │ 
  68 │ 
  69 │ 
  70 │ 
  71 │ 
  72 │ 
  73 │ 
  74 │ 
  75 │ </span></pre><pre><code class="hljs language-c"><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> u64;

<span class="hljs-type">void</span> <span class="hljs-title function_">putchar</span> <span class="hljs-params">(<span class="hljs-type">char</span> ch)</span> {
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(
        <span class="hljs-string">".intel_syntax noprefix\n"</span>
        <span class="hljs-string">"mov eax, 1\n"</span>
        <span class="hljs-string">"mov edi, 1\n"</span>
        <span class="hljs-string">"mov rsi, %[buf]\n"</span>
        <span class="hljs-string">"mov rdx, 1\n"</span>
        <span class="hljs-string">"syscall\n"</span>
        <span class="hljs-string">".att_syntax prefix\n"</span>
        :: [buf] <span class="hljs-string">"r"</span> (&#x26;ch)
        : <span class="hljs-string">"rax"</span>, <span class="hljs-string">"rdi"</span>, <span class="hljs-string">"rsi"</span>, <span class="hljs-string">"rdx"</span>, <span class="hljs-string">"rcx"</span>, <span class="hljs-string">"r11"</span>
    )</span>;
}

<span class="hljs-type">void</span> <span class="hljs-title function_">puts</span> <span class="hljs-params">(<span class="hljs-type">char</span> * s)</span> {
    <span class="hljs-keyword">while</span> (*s != <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">putchar</span>(*s);
        s++;
    }
    <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'\n'</span>);
}

<span class="hljs-type">void</span> <span class="hljs-title function_">exit</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> {
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(
        <span class="hljs-string">"mov $60, %%eax\n"</span>
        <span class="hljs-string">"syscall\n"</span>
        :: [code] <span class="hljs-string">"rdi"</span> (code)
    )</span>;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">probe</span><span class="hljs-params">(<span class="hljs-type">void</span> * addr)</span> {
    u64 tic_hi, tic_lo, toc_hi, toc_lo;
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(
        <span class="hljs-string">".intel_syntax noprefix\n"</span>
        <span class="hljs-string">"vpxor ymm0, ymm0, ymm0\n"</span>
        <span class="hljs-string">"vmaskmovps ymm0, ymm0, ymmword ptr [%[ptr]]\n"</span>
        <span class="hljs-string">"mfence\n"</span>
        <span class="hljs-string">"rdtsc\n"</span>
        <span class="hljs-string">"mov %[hi], rdx\n"</span>
        <span class="hljs-string">"mov %[lo], rax\n"</span>
        <span class="hljs-string">"mfence\n"</span>
        <span class="hljs-string">"vmaskmovps ymm0, ymm0, ymmword ptr [%[ptr]]\n"</span>
        <span class="hljs-string">"mfence\n"</span>
        <span class="hljs-string">"rdtsc\n"</span>
        <span class="hljs-string">"mov %[thi], rdx\n"</span>
        <span class="hljs-string">"mov %[tlo], rax\n"</span>
        <span class="hljs-string">".att_syntax prefix\n"</span>
        : [hi] <span class="hljs-string">"=r"</span> (tic_hi),
          [lo] <span class="hljs-string">"=r"</span> (tic_lo),
          [thi] <span class="hljs-string">"=r"</span> (toc_hi),
          [tlo] <span class="hljs-string">"=r"</span> (toc_lo)
        : [ptr] <span class="hljs-string">"r"</span> (addr)
        : <span class="hljs-string">"ymm0"</span>, <span class="hljs-string">"rdx"</span>, <span class="hljs-string">"rax"</span>
    )</span>;
    <span class="hljs-keyword">return</span> ((toc_hi &#x3C;&#x3C; <span class="hljs-number">32</span>) + toc_lo) - ((tic_hi &#x3C;&#x3C; <span class="hljs-number">32</span>) + tic_lo);
}

<span class="hljs-comment">// we put the main function into the `.entry` section</span>
<span class="hljs-comment">// and use custom linker script in order to guarantee</span>
<span class="hljs-comment">// main is run first in the flat binary</span>
<span class="hljs-type">void</span> __attribute__((section(<span class="hljs-string">".entry"</span>))) main () {
    u64 base = <span class="hljs-number">0x1337000</span>;

    <span class="hljs-keyword">while</span> (base &#x3C; <span class="hljs-number">0x1337000</span> + <span class="hljs-number">0x100000000</span>) {
        <span class="hljs-type">int</span> access = probe(base);
        <span class="hljs-keyword">if</span> (access &#x3C; <span class="hljs-number">140</span>) {
            <span class="hljs-built_in">puts</span>(<span class="hljs-string">"FOUND"</span>);
            <span class="hljs-built_in">puts</span>((<span class="hljs-type">char</span> *)base);
            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'\n'</span>);
        }
        base += <span class="hljs-number">0x1000</span>;
    }
}
</code></pre></div>